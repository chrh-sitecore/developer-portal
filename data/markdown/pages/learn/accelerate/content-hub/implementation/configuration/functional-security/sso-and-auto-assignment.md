---
title: 'SSO and Auto-Assignment'
description: ''
hasSubPageNav: false
hasInPageNav: false
area: ['accelerate']
lastUpdated: '2024-11-14'
breadcrumb: 'Sitecore Accelerate Cookbooks > Content Hub (CH) - Sitecore Recipes > CH Implementation > CH Configuration > Functional Security (Users and User Groups)'
author: 'Jeroen Feyaerts'
---
## ![(blue star)](/images/learn/accelerate/content-hub/img/icons/emoticons/72/2049.png) Problem

As a company I want to centrally manage users and user access for the applications in my application landscape. One of these applications will be Content Hub.

In order to achieve this I want to enable SSO login on Content Hub to vary the user’s identity on my IDP of choice. Additionally I would like to control user access based on the user Claims received after a successful login into my IDP.

For this recipe we are using Microsoft Entra ID (previous called Microsoft Azure AD).

## ![(lightbulb)](/images/learn/accelerate/content-hub/img/icons/emoticons/lightbulb_on.png) Solution

### SSO setup in Content Hub

#### Microsoft Entra ID Setup

An new enterprise application should be provisioned on Microsoft Entra ID. It is important to take note on the following details when configuring the Enterprise application.

##### Allowed redirect url’s

The allowed redirect url should be configured as following to ensure a post back to Content Hub after login is allowed. Where \[**contenthubinstance**\] is your contenthub url.

[https://\[contenthubinstance\]/AuthServices-saml/Acs](#)

##### Token configuration (SAML Claims)

The following SAML Claims should be configured in order to fulfill the requirements in this recipe

*   **Email**
    
*   **Security Groups**
    

\> _On Microsoft Entra ID the number of groups emitted in a token is limited to 150 for SAML. For companies having a lot of security groups, this can be an issue as groups claims will be totally omitted for users having a membership in 150+ groups. As a workaround use user group assignment on your application if possible or apply a group filter as described in the following article._ [https://learn.microsoft.com/en-us/entra/identity/hybrid/connect/how-to-connect-fed-group-claims](https://learn.microsoft.com/en-us/entra/identity/hybrid/connect/how-to-connect-fed-group-claims)

#### Content Hub configuration

Navigate to the Content Hub settings page as a super user (Manage \> Settings). Under Portal Configuration you can find the Authentication setting.

As we are using saml, we will need to setup the saml provider. with the following details.

*   **authentication\_mode**: Passive or Active. _Setting this configuration on Active means you won’t be prompted with a Content Hub login screen, but you will be redirected immediately to your IDP instead. TIP: Leave this set as Passive for your first tests._
    
*   **email\_claim\_type:** [http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress](http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress). _Unless configured differently on Microsoft Entra ID, this is the default for email addresses._
    
*   **idp\_entity\_id**: _This can be found on the metadataxml generated by Microsoft Entra ID (entityID on the root node of the document)_
    
*   **metadata\_location:** _Please provide the link towards your metadata xml as provided by your enterprise application on Microsoft Entra ID._
    
*   **provider\_name:** SAML _(default)_
    
*   **sp\_entity\_id**: _As configured on Azure Entra ID_
    
*   **username\_claim\_type**: [http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name](http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name). _Unless configured differently on Microsoft Entra ID, this is the default._
    

```csharp

  "ExternalAuthenticationProviders": {
    "global_username_claim_type": "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name",
    "global_email_claim_type": "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress",
    "google": [],
    "microsoft": [],
    "saml": [
      {
        "authentication_mode": "Passive",
        "email_claim_type": "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress",
        "idp_entity_id": "url to be found on metadataxml (entityID on root node)",
        "is_enabled": true,
        "metadata_location": "https://login.microsoftonline.com/link-to-your-metadataxml",
        "provider_name": "SAML",
        "sp_entity_id": "as configured on Azure Entra ID",
        "username_claim_type": "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name",
        "messages": {
          "signIn": "Sign in with SSO"
        }
      }
    ],
    "sitecore": [],
    "ws_federation": [],
    "yandex": []
  },
```

As a first test, you can now try to login into Content Hub with SSO. Users are automatically created on first login.

\> TIP: You can bypass a Active configuration by forcing passive mode by appending the following query string. [https://contenthubinstance/en-US/Account?forcePassive=true](https://contenthubinstance/en-US/Account?forcePassive=true).
\> 
\> This might be useful if you still like to login as regular user into Content Hub. eg.: to perform administrative tasks as a Super User.

### Automated Claim to Content Hub Security Groups mapping

As we want to centrally manage security group membership, Microsoft Entra ID is a good place to do this. However, we do also want this being reflected into our Content Hub Application. In order to do this we will need to read-out any group Claims that will be emitted at login and do some AD group to Content Hub mapping magic.

The two necessary parts to make this working on Content Hub are

*   A setting to configure the desired group mapping
    
*   A sign-in script that reads out the group claims at login and applies the mapping so the user has the appropriate security rights after login.
    

#### Environment specific setting creation

We could just go ahead and create a new setting on the Content Hub from the interface (Manage \> Settings).

However, you might have multiple Content Hub environments (DEV, UAT, PROD) and it might be required to have a different mapping configurations per environment as the AD groups are potentially different for each environment. In order to create a environment specific setting we will need to do a POST request to create to entity with your tool of choice (eg.: POSTMAN). Unfortunately this is not possible through the interface as `"M.Setting.EnvironmentSpecific"` is marked as set-once.

**Endpoint**: [https://contenthubinstance/api/entities](https://contenthubinstance/api/entities)

**Method**: POST

**Body**:

```csharp

{
	"identifier": "M.Setting.SSOMapping",
	"properties": {
		"M.Setting.Name": "SSOMapping",
		"M.Setting.EnvironmentSpecific": true,
		"M.Setting.Value": {}
	},
	"relations": {
		"SettingCategoryToSettings": {
			"parent": {
				"href": "https://[contenthubinstance]/api/entities/759"
			}
		}
	},
	"entitydefinition": {
		"href": "https://[contenthubinstance]/api/entitydefinitions/M.Setting"
	}
}
```

\> Please note `M.Setting.EnvironmentSpecific` has been set to true at creation time as this is the **only moment** where we can set this property.

Once you have executed the POST command, you should have a new setting available under Security\>SSOMapping. Now it is a good time to populate the mapping setting with some default values.

Example

```csharp

{
  "groupMapping": [
    {
      "label": "SuperUser mapping",
      "external": "2db23085-7778-4d35-b2bb-3869fbc47552",
      "internal": "superuser"
    }
  ],
  "claimTypes": [
    "http://schemas.microsoft.com/ws/2008/06/identity/claims/groups"
  ]
}
```

The external property indicates the external group that comes in through the Claims emitted by Entra ID, the internal property indicates to which Content Hub usergroup it will be mapped to.

#### User Sign-in script creation

The only thing left to make our automated mapping working is to add a user sign-in script. Navigate to Scripts under the Manage section and add a new sign-in script.

![image-20241115-144359.png](/images/learn/accelerate/content-hub/attachments/5402525820/5430673420.png?width=497)

Next import the following mapping code in your User sign-in script. Build, Publish and enable the script.

```csharp

TODO
```

If everything works as expected, users that login into Content Hub should be automatically assigned to the appropriate user groups, based on group information emitted by your IDP.

|     |     |     |
| --- | --- | --- |
|     | **Application** | **Function** |
| 1   |     |     |
| 2   |     |     |

## ![(blue star)](/images/learn/accelerate/content-hub/img/icons/emoticons/72/1f5e8.png) Discussion

## ![(blue star)](/images/learn/accelerate/content-hub/img/icons/emoticons/72/1f329.png) Product Gaps

## ![(blue star)](/images/learn/accelerate/content-hub/img/icons/emoticons/72/1f517.png) Related Recipes

|     |     |
| --- | --- |
|     | **Recipe** |
| 1   |     |
| 2   |     |

## ![(blue star)](/images/learn/accelerate/content-hub/img/icons/emoticons/72/1f517.png) Related Documentation

|     |     |
| --- | --- |
|     | **Documentation Link** |
| 1   | [https://learn.microsoft.com/en-us/entra/identity/hybrid/connect/how-to-connect-fed-group-claims](https://learn.microsoft.com/en-us/entra/identity/hybrid/connect/how-to-connect-fed-group-claims) |
| 2   | [https://doc.sitecore.com/ch/en/users/content-hub/authentication-configuration-example.html](https://doc.sitecore.com/ch/en/users/content-hub/authentication-configuration-example.html) |
| 3   | [https://doc.sitecore.com/ch/en/users/content-hub/authentication.html](https://doc.sitecore.com/ch/en/users/content-hub/authentication.html) |

## ![(blue star)](/images/learn/accelerate/content-hub/img/icons/emoticons/72/1f517.png) Related Learning Materials

List any related Learning activity to this recipe.

|     |     |
| --- | --- |
|     | **Learning link** |
| 1   |     |
| 2   |     |

## ![(blue star)](/images/learn/accelerate/content-hub/img/icons/emoticons/72/1f517.png) Related 360 Activities

|     |     |
| --- | --- |
|     | **Activity Link** |
| 1   |     |
| 2   |     |

## ![(blue star)](/images/learn/accelerate/content-hub/img/icons/emoticons/72/1f517.png) Related Value Realization Framework Activities

|     |     |
| --- | --- |
|     | **VRF Card Link** |
| 1   |     |
| 2   |     |